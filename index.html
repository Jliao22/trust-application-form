<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>國際離岸信託申請表單 | Timeless Trust</title>
    <link rel="stylesheet" href="style.css">
    <!-- 使用CDN加載Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- 使用CDN加載html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* 內嵌基本樣式，確保即使外部CSS未加載也能顯示 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, "Microsoft JhengHei", sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f9f9f9;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .logo-section {
            display: flex;
            align-items: center;
        }
        .logo {
            height: 60px;
            margin-right: 20px;
        }
        .header-text h1 {
            font-size: 1.5rem;
            color: #c9b16a;
            margin-bottom: 5px;
        }
        .header-text h2 {
            font-size: 1.2rem;
            color: #333;
        }
        .language-toggle {
            display: flex;
            gap: 10px;
        }
        .lang-btn {
            padding: 8px 15px;
            background-color: transparent;
            border: 1px solid #c9b16a;
            color: #c9b16a;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .lang-btn.active {
            background-color: #c9b16a;
            color: white;
        }
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #ddd;
            z-index: 1;
        }
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
            cursor: pointer;
        }
        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .progress-step.active .step-number {
            background-color: #c9b16a;
            border-color: #c9b16a;
            color: white;
        }
        .form-step {
            display: none;
            padding: 30px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .form-step.active {
            display: block;
        }
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #c9b16a;
        }
        .form-section h4 {
            font-size: 1.2rem;
            color: #c9b16a;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
        }
        .form-group {
            flex: 1;
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
        }
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background-color: #c9b16a;
            color: white;
        }
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 頁首 -->
        <header class="header">
            <div class="logo-section">
                <img src="assets/logo.png" alt="Timeless Trust" class="logo">
                <div class="header-text">
                    <h1>Application for International Off-shore Trust</h1>
                    <h2>國際離岸信託申請表單</h2>
                </div>
            </div>
            <div class="language-toggle">
                <button class="lang-btn active" data-lang="zh">中文</button>
                <button class="lang-btn" data-lang="en">English</button>
            </div>
        </header>

        <!-- 進度條 -->
        <div class="progress-bar" data-progress="1">
            <div class="progress-step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label" data-lang-zh="委託人資料" data-lang-en="Settlor Info">委託人資料</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label" data-lang-zh="銀行與資金" data-lang-en="Bank & Funds">銀行與資金</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label" data-lang-zh="受益人" data-lang-en="Beneficiaries">受益人</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label" data-lang-zh="文件上傳" data-lang-en="Documents">文件上傳</div>
            </div>
            <div class="progress-step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-label" data-lang-zh="確認提交" data-lang-en="Review">確認提交</div>
            </div>
        </div>

        <!-- 表單 -->
        <form id="trustForm" class="trust-form">
            <!-- 步驟 1: 委託人資料 -->
            <div class="form-step active" data-step="1">
                <div class="form-section">
                    <h4 data-lang-zh="委託人基本資料" data-lang-en="Settlor Basic Information">委託人基本資料</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="settlorName" data-lang-zh="姓名" data-lang-en="Name">姓名</label>
                            <input type="text" id="settlorName" name="settlorName" required>
                        </div>
                        <div class="form-group">
                            <label for="settlorIdNumber" data-lang-zh="身份證/護照號碼" data-lang-en="ID/Passport Number">身份證/護照號碼</label>
                            <input type="text" id="settlorIdNumber" name="settlorIdNumber" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nationality" data-lang-zh="國籍" data-lang-en="Nationality">國籍</label>
                            <input type="text" id="nationality" name="nationality" required>
                        </div>
                        <div class="form-group">
                            <label for="dateOfBirth" data-lang-zh="出生日期" data-lang-en="Date of Birth">出生日期</label>
                            <input type="date" id="dateOfBirth" name="dateOfBirth" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4 data-lang-zh="聯絡資訊" data-lang-en="Contact Information">聯絡資訊</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone" data-lang-zh="聯絡電話" data-lang-en="Contact Phone">聯絡電話</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="email" data-lang-zh="電子郵件" data-lang-en="Email">電子郵件</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="address" data-lang-zh="地址" data-lang-en="Address">地址</label>
                        <textarea id="address" name="address" rows="3" required></textarea>
                    </div>
                </div>

                <div class="form-navigation">
                    <div></div>
                    <button type="button" class="btn btn-primary btn-next" data-lang-zh="下一步" data-lang-en="Next">下一步</button>
                </div>
            </div>

            <!-- 步驟 2: 銀行資料與資金來源 -->
            <div class="form-step" data-step="2">
                <div class="form-section">
                    <h4 data-lang-zh="銀行資料" data-lang-en="Bank Information">銀行資料</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bankName" data-lang-zh="銀行名稱" data-lang-en="Bank Name">銀行名稱</label>
                            <input type="text" id="bankName" name="bankName">
                        </div>
                        <div class="form-group">
                            <label for="accountNumber" data-lang-zh="帳戶號碼" data-lang-en="Account Number">帳戶號碼</label>
                            <input type="text" id="accountNumber" name="accountNumber">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="accountName" data-lang-zh="帳戶名稱" data-lang-en="Account Name">帳戶名稱</label>
                            <input type="text" id="accountName" name="accountName">
                        </div>
                        <div class="form-group">
                            <label for="swiftCode" data-lang-zh="SWIFT代碼" data-lang-en="SWIFT Code">SWIFT代碼</label>
                            <input type="text" id="swiftCode" name="swiftCode">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bankAddress" data-lang-zh="銀行地址" data-lang-en="Bank Address">銀行地址</label>
                        <textarea id="bankAddress" name="bankAddress" rows="3"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h4 data-lang-zh="資金來源" data-lang-en="Source of Funds">資金來源</h4>
                    <div class="form-group">
                        <label data-lang-zh="資金來源" data-lang-en="Source of Funds">資金來源</label>
                        <div class="radio-options">
                            <div class="radio-option">
                                <input type="radio" id="incomeSource1" name="incomeSource" value="employed" required>
                                <label for="incomeSource1" data-lang-zh="受雇" data-lang-en="Employed">受雇</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="incomeSource2" name="incomeSource" value="selfEmployed">
                                <label for="incomeSource2" data-lang-zh="自顧" data-lang-en="Self-employed">自顧</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="incomeSource3" name="incomeSource" value="investment">
                                <label for="incomeSource3" data-lang-zh="投資" data-lang-en="Investment">投資</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="incomeSource4" name="incomeSource" value="inheritance">
                                <label for="incomeSource4" data-lang-zh="繼承" data-lang-en="Inheritance">繼承</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="incomeSource5" name="incomeSource" value="gift">
                                <label for="incomeSource5" data-lang-zh="贈與" data-lang-en="Gift">贈與</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="incomeSource6" name="incomeSource" value="other">
                                <label for="incomeSource6" data-lang-zh="其他" data-lang-en="Other">其他</label>
                            </div>
                        </div>
                    </div>

                    <div id="employmentFields" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="employer" data-lang-zh="僱主" data-lang-en="Employer">僱主</label>
                                <input type="text" id="employer" name="employer">
                            </div>
                            <div class="form-group">
                                <label for="employmentYear" data-lang-zh="就業年份" data-lang-en="Year of Employment">就業年份</label>
                                <input type="number" id="employmentYear" name="employmentYear" min="1900" max="2100">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="position" data-lang-zh="職位" data-lang-en="Position">職位</label>
                                <input type="text" id="position" name="position">
                            </div>
                            <div class="form-group">
                                <label for="annualIncome" data-lang-zh="全年收入" data-lang-en="Annual Income">全年收入</label>
                                <input type="text" id="annualIncome" name="annualIncome">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="employerAddress" data-lang-zh="僱主地址" data-lang-en="Address of Employment">僱主地址</label>
                            <textarea id="employerAddress" name="employerAddress" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary btn-prev" data-lang-zh="上一步" data-lang-en="Previous">上一步</button>
                    <button type="button" class="btn btn-primary btn-next" data-lang-zh="下一步" data-lang-en="Next">下一步</button>
                </div>
            </div>

            <!-- 步驟 3: 受益人資料 -->
            <div class="form-step" data-step="3">
                <div class="form-section">
                    <h4 data-lang-zh="受益人資料" data-lang-en="Beneficiary Information">受益人資料</h4>
                    <div id="beneficiariesContainer">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="beneficiaryName1" data-lang-zh="姓名" data-lang-en="Name">姓名</label>
                                <input type="text" id="beneficiaryName1" name="beneficiaryName1" required>
                            </div>
                            <div class="form-group">
                                <label for="beneficiaryRelationship1" data-lang-zh="與委託人關係" data-lang-en="Relationship to Settlor">與委託人關係</label>
                                <input type="text" id="beneficiaryRelationship1" name="beneficiaryRelationship1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="beneficiaryIdNumber1" data-lang-zh="身份證/護照號碼" data-lang-en="ID/Passport Number">身份證/護照號碼</label>
                                <input type="text" id="beneficiaryIdNumber1" name="beneficiaryIdNumber1" required>
                            </div>
                            <div class="form-group">
                                <label for="beneficiaryPercentage1" data-lang-zh="分配比例 (%)" data-lang-en="Distribution Percentage (%)">分配比例 (%)</label>
                                <input type="number" id="beneficiaryPercentage1" name="beneficiaryPercentage1" min="1" max="100" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="beneficiaryPhone1" data-lang-zh="聯絡電話" data-lang-en="Contact Phone">聯絡電話</label>
                                <input type="tel" id="beneficiaryPhone1" name="beneficiaryPhone1" required>
                            </div>
                            <div class="form-group">
                                <label for="beneficiaryEmail1" data-lang-zh="電子郵件" data-lang-en="Email">電子郵件</label>
                                <input type="email" id="beneficiaryEmail1" name="beneficiaryEmail1" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="beneficiaryAddress1" data-lang-zh="地址" data-lang-en="Address">地址</label>
                            <textarea id="beneficiaryAddress1" name="beneficiaryAddress1" rows="3" required></textarea>
                        </div>
                    </div>
                    <button type="button" id="addBeneficiary" class="btn btn-outline" data-lang-zh="添加受益人" data-lang-en="Add Beneficiary">添加受益人</button>
                </div>

                <div class="form-section">
                    <h4 data-lang-zh="次位受益人資料" data-lang-en="Contingent Beneficiary Information">次位受益人資料</h4>
                    <div id="contingentBeneficiariesContainer">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contingentBeneficiaryName1" data-lang-zh="姓名" data-lang-en="Name">姓名</label>
                                <input type="text" id="contingentBeneficiaryName1" name="contingentBeneficiaryName1">
                            </div>
                            <div class="form-group">
                                <label for="contingentBeneficiaryRelationship1" data-lang-zh="與委託人關係" data-lang-en="Relationship to Settlor">與委託人關係</label>
                                <input type="text" id="contingentBeneficiaryRelationship1" name="contingentBeneficiaryRelationship1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contingentBeneficiaryIdNumber1" data-lang-zh="身份證/護照號碼" data-lang-en="ID/Passport Number">身份證/護照號碼</label>
                                <input type="text" id="contingentBeneficiaryIdNumber1" name="contingentBeneficiaryIdNumber1">
                            </div>
                            <div class="form-group">
                                <label for="contingentBeneficiaryPercentage1" data-lang-zh="分配比例 (%)" data-lang-en="Distribution Percentage (%)">分配比例 (%)</label>
                                <input type="number" id="contingentBeneficiaryPercentage1" name="contingentBeneficiaryPercentage1" min="1" max="100">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contingentBeneficiaryPhone1" data-lang-zh="聯絡電話" data-lang-en="Contact Phone">聯絡電話</label>
                                <input type="tel" id="contingentBeneficiaryPhone1" name="contingentBeneficiaryPhone1">
                            </div>
                            <div class="form-group">
                                <label for="contingentBeneficiaryEmail1" data-lang-zh="電子郵件" data-lang-en="Email">電子郵件</label>
                                <input type="email" id="contingentBeneficiaryEmail1" name="contingentBeneficiaryEmail1">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="contingentBeneficiaryAddress1" data-lang-zh="地址" data-lang-en="Address">地址</label>
                            <textarea id="contingentBeneficiaryAddress1" name="contingentBeneficiaryAddress1" rows="3"></textarea>
                        </div>
                    </div>
                    <button type="button" id="addContingentBeneficiary" class="btn btn-outline" data-lang-zh="添加次位受益人" data-lang-en="Add Contingent Beneficiary">添加次位受益人</button>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary btn-prev" data-lang-zh="上一步" data-lang-en="Previous">上一步</button>
                    <button type="button" class="btn btn-primary btn-next" data-lang-zh="下一步" data-lang-en="Next">下一步</button>
                </div>
            </div>

            <!-- 步驟 4: 文件上傳 -->
            <div class="form-step" data-step="4">
                <div class="form-section">
                    <h4 data-lang-zh="上傳文件" data-lang-en="Upload Documents">上傳文件</h4>
                    <div class="form-group">
                        <label for="idDocument" data-lang-zh="身份證明文件（護照/身份證）" data-lang-en="Identity Document (Passport/ID)">身份證明文件（護照/身份證）</label>
                        <div class="file-input-container">
                            <input type="file" id="idDocument" name="idDocument" accept=".pdf,.jpg,.jpeg,.png">
                            <label for="idDocument" class="file-input-button" data-lang-zh="選擇文件" data-lang-en="Choose File">選擇文件</label>
                            <span id="idDocumentName" class="file-input-name"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="addressProof" data-lang-zh="地址證明" data-lang-en="Proof of Address">地址證明</label>
                        <div class="file-input-container">
                            <input type="file" id="addressProof" name="addressProof" accept=".pdf,.jpg,.jpeg,.png">
                            <label for="addressProof" class="file-input-button" data-lang-zh="選擇文件" data-lang-en="Choose File">選擇文件</label>
                            <span id="addressProofName" class="file-input-name"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bankProof" data-lang-zh="銀行帳戶證明" data-lang-en="Bank Account Proof">銀行帳戶證明</label>
                        <div class="file-input-container">
                            <input type="file" id="bankProof" name="bankProof" accept=".pdf,.jpg,.jpeg,.png">
                            <label for="bankProof" class="file-input-button" data-lang-zh="選擇文件" data-lang-en="Choose File">選擇文件</label>
                            <span id="bankProofName" class="file-input-name"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="fundsProof" data-lang-zh="資金來源證明" data-lang-en="Proof of Source of Funds">資金來源證明</label>
                        <div class="file-input-container">
                            <input type="file" id="fundsProof" name="fundsProof" accept=".pdf,.jpg,.jpeg,.png">
                            <label for="fundsProof" class="file-input-button" data-lang-zh="選擇文件" data-lang-en="Choose File">選擇文件</label>
                            <span id="fundsProofName" class="file-input-name"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="otherDocument" data-lang-zh="其他相關文件" data-lang-en="Other Related Documents">其他相關文件</label>
                        <div class="file-input-container">
                            <input type="file" id="otherDocument" name="otherDocument" accept=".pdf,.jpg,.jpeg,.png">
                            <label for="otherDocument" class="file-input-button" data-lang-zh="選擇文件" data-lang-en="Choose File">選擇文件</label>
                            <span id="otherDocumentName" class="file-input-name"></span>
                        </div>
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary btn-prev" data-lang-zh="上一步" data-lang-en="Previous">上一步</button>
                    <button type="button" class="btn btn-primary btn-next" data-lang-zh="下一步" data-lang-en="Next">下一步</button>
                </div>
            </div>

            <!-- 步驟 5: 確認提交 -->
            <div class="form-step" data-step="5">
                <div class="form-section">
                    <h4 data-lang-zh="表單預覽" data-lang-en="Form Preview">表單預覽</h4>
                    <div id="formPreview" class="form-preview"></div>
                </div>

                <div class="form-section">
                    <h4 data-lang-zh="聲明與同意" data-lang-en="Declaration and Agreement">聲明與同意</h4>
                    <div class="form-group">
                        <div class="checkbox-option">
                            <input type="checkbox" id="agreement" name="agreement" required>
                            <label for="agreement" data-lang-zh="我確認所提供的資料真實無誤，並同意信託公司處理我的個人資料。" data-lang-en="I confirm that the information provided is true and accurate, and I agree to the trust company processing my personal data.">我確認所提供的資料真實無誤，並同意信託公司處理我的個人資料。</label>
                        </div>
                    </div>
                </div>

                <div id="loadingMessage" style="display: none; text-align: center; margin: 20px 0;">
                    <p data-lang-zh="正在生成PDF，請稍候..." data-lang-en="Generating PDF, please wait...">正在生成PDF，請稍候...</p>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary btn-prev" data-lang-zh="上一步" data-lang-en="Previous">上一步</button>
                    <button type="submit" class="btn btn-primary" data-lang-zh="提交申請" data-lang-en="Submit Application">提交申請</button>
                </div>
            </div>
        </form>

        <!-- 成功訊息 -->
        <div id="successMessage" class="success-message" style="display: none;">
            <div class="success-icon">✓</div>
            <h3 data-lang-zh="申請提交成功！" data-lang-en="Application Submitted Successfully!">申請提交成功！</h3>
            <p data-lang-zh="您的國際離岸信託申請表單已成功提交。PDF文件已開始下載，請查看您的下載資料夾。" data-lang-en="Your International Off-shore Trust application form has been successfully submitted. The PDF file has started downloading, please check your downloads folder.">您的國際離岸信託申請表單已成功提交。PDF文件已開始下載，請查看您的下載資料夾。</p>
            <div class="success-actions">
                <button type="button" class="btn btn-primary" onclick="resetForm()" data-lang-zh="提交新申請" data-lang-en="Submit New Application">提交新申請</button>
            </div>
        </div>
    </div>

    <script>
        // 全局變數
        let currentStep = 1;
        const totalSteps = 5;
        let formData = {};
        let currentLang = 'zh';
        let beneficiaryCount = 1;
        let contingentBeneficiaryCount = 1;

        // DOM 元素
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化表單
            initForm();
            
            // 語言切換
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchLanguage(this.getAttribute('data-lang'));
                });
            });
            
            // 進度條點擊
            document.querySelectorAll('.progress-step').forEach(step => {
                step.addEventListener('click', function() {
                    const stepNum = parseInt(this.getAttribute('data-step'));
                    if (validateCurrentStep()) {
                        goToStep(stepNum);
                    }
                });
            });
            
            // 下一步按鈕
            document.querySelectorAll('.btn-next').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (validateCurrentStep()) {
                        goToStep(currentStep + 1);
                    }
                });
            });
            
            // 上一步按鈕
            document.querySelectorAll('.btn-prev').forEach(btn => {
                btn.addEventListener('click', function() {
                    goToStep(currentStep - 1);
                });
            });
            
            // 添加受益人按鈕
            document.getElementById('addBeneficiary').addEventListener('click', function() {
                addBeneficiary();
            });
            
            // 添加次位受益人按鈕
            document.getElementById('addContingentBeneficiary').addEventListener('click', function() {
                addContingentBeneficiary();
            });
            
            // 資金來源選擇變更
            document.querySelectorAll('input[name="incomeSource"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    toggleEmployerFields();
                });
            });
            
            // 提交表單
            document.getElementById('trustForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateCurrentStep()) {
                    collectFormData();
                    generatePDF();
                }
            });
            
            // 文件上傳預覽
            setupFileUploads();
        });

        // 初始化表單
        function initForm() {
            goToStep(1);
            toggleEmployerFields();
        }

        // 切換到指定步驟
        function goToStep(step) {
            // 保存當前步驟的數據
            collectFormData();
            
            // 隱藏所有步驟
            document.querySelectorAll('.form-step').forEach(formStep => {
                formStep.classList.remove('active');
            });
            
            // 顯示目標步驟
            document.querySelector(`.form-step[data-step="${step}"]`).classList.add('active');
            
            // 更新進度條
            document.querySelectorAll('.progress-step').forEach(progressStep => {
                const stepNum = parseInt(progressStep.getAttribute('data-step'));
                progressStep.classList.remove('active', 'completed');
                
                if (stepNum === step) {
                    progressStep.classList.add('active');
                } else if (stepNum < step) {
                    progressStep.classList.add('completed');
                }
            });
            
            // 更新當前步驟
            currentStep = step;
            
            // 如果是最後一步，生成預覽
            if (step === totalSteps) {
                generatePreview();
            }
            
            // 滾動到頂部
            window.scrollTo(0, 0);
        }

        // 驗證當前步驟
        function validateCurrentStep() {
            let isValid = true;
            const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"]`);
            
            // 清除所有錯誤
            currentStepElement.querySelectorAll('.form-group').forEach(group => {
                group.classList.remove('error');
            });
            
            // 驗證必填欄位
            currentStepElement.querySelectorAll('[required]').forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.closest('.form-group').classList.add('error');
                }
                
                // 電子郵件驗證
                if (field.type === 'email' && field.value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(field.value)) {
                        isValid = false;
                        field.closest('.form-group').classList.add('error');
                    }
                }
                
                // 電話驗證
                if (field.name.includes('phone') && field.value) {
                    const phoneRegex = /^[0-9+\-\s()]{8,20}$/;
                    if (!phoneRegex.test(field.value)) {
                        isValid = false;
                        field.closest('.form-group').classList.add('error');
                    }
                }
            });
            
            return isValid;
        }

        // 收集表單數據
        function collectFormData() {
            const form = document.getElementById('trustForm');
            const formElements = form.elements;
            
            for (let i = 0; i < formElements.length; i++) {
                const element = formElements[i];
                
                // 跳過按鈕和沒有名稱的元素
                if (element.type === 'button' || element.type === 'submit' || !element.name) {
                    continue;
                }
                
                // 處理單選按鈕
                if (element.type === 'radio') {
                    if (element.checked) {
                        formData[element.name] = element.value;
                    }
                    continue;
                }
                
                // 處理複選框
                if (element.type === 'checkbox') {
                    formData[element.name] = element.checked;
                    continue;
                }
                
                // 處理其他輸入類型
                formData[element.name] = element.value;
            }
            
            // 保存到本地存儲
            localStorage.setItem('trustFormData', JSON.stringify(formData));
            
            return formData;
        }

        // 切換語言
        function switchLanguage(lang) {
            currentLang = lang;
            
            // 更新語言按鈕狀態
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                }
            });
            
            // 更新所有帶有 data-lang-zh 和 data-lang-en 屬性的元素
            document.querySelectorAll('[data-lang-zh][data-lang-en]').forEach(element => {
                element.textContent = element.getAttribute(`data-lang-${lang}`);
            });
        }

        // 添加受益人
        function addBeneficiary() {
            beneficiaryCount++;
            
            const beneficiariesContainer = document.getElementById('beneficiariesContainer');
            const newBeneficiary = document.createElement('div');
            newBeneficiary.className = 'contingent-beneficiary';
            newBeneficiary.innerHTML = `
                <div class="beneficiary-header">
                    <h5 data-lang-zh="受益人 #${beneficiaryCount}" data-lang-en="Beneficiary #${beneficiaryCount}">受益人 #${beneficiaryCount}</h5>
                    <button type="button" class="remove-beneficiary" onclick="removeBeneficiary(this)">×</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-lang-zh="姓名" data-lang-en="Name">姓名</label>
                        <input type="text" name="beneficiaryName${beneficiaryCount}" required>
                    </div>
                    <div class="form-group">
                        <label data-lang-zh="與委託人關係" data-lang-en="Relationship to Settlor">與委託人關係</label>
                        <input type="text" name="beneficiaryRelationship${beneficiaryCount}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-lang-zh="身份證/護照號碼" data-lang-en="ID/Passport Number">身份證/護照號碼</label>
                        <input type="text" name="beneficiaryIdNumber${beneficiaryCount}" required>
                    </div>
                    <div class="form-group">
                        <label data-lang-zh="分配比例 (%)" data-lang-en="Distribution Percentage (%)">分配比例 (%)</label>
                        <input type="number" name="beneficiaryPercentage${beneficiaryCount}" min="1" max="100" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-lang-zh="聯絡電話" data-lang-en="Contact Phone">聯絡電話</label>
                        <input type="tel" name="beneficiaryPhone${beneficiaryCount}" required>
                    </div>
                    <div class="form-group">
                        <label data-lang-zh="電子郵件" data-lang-en="Email">電子郵件</label>
                        <input type="email" name="beneficiaryEmail${beneficiaryCount}" required>
                    </div>
                </div>
                <div class="form-group">
                    <label data-lang-zh="地址" data-lang-en="Address">地址</label>
                    <textarea name="beneficiaryAddress${beneficiaryCount}" rows="3" required></textarea>
                </div>
            `;
            
            beneficiariesContainer.appendChild(newBeneficiary);
            
            // 更新語言
            switchLanguage(currentLang);
        }

        // 移除受益人
        function removeBeneficiary(button) {
            const beneficiary = button.closest('.contingent-beneficiary');
            beneficiary.remove();
        }

        // 添加次位受益人
        function addContingentBeneficiary() {
            contingentBeneficiaryCount++;
            
            const contingentBeneficiariesContainer = document.getElementById('contingentBeneficiariesContainer');
            const newContingentBeneficiary = document.createElement('div');
            newContingentBeneficiary.className = 'contingent-beneficiary';
            newContingentBeneficiary.innerHTML = `
                <div class="beneficiary-header">
                    <h5 data-lang-zh="次位受益人 #${contingentBeneficiaryCount}" data-lang-en="Contingent Beneficiary #${contingentBeneficiaryCount}">次位受益人 #${contingentBeneficiaryCount}</h5>
                    <button type="button" class="remove-beneficiary" onclick="removeContingentBeneficiary(this)">×</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-lang-zh="姓名" data-lang-en="Name">姓名</label>
                        <input type="text" name="contingentBeneficiaryName${contingentBeneficiaryCount}">
                    </div>
                    <div class="form-group">
                        <label data-lang-zh="與委託人關係" data-lang-en="Relationship to Settlor">與委託人關係</label>
                        <input type="text" name="contingentBeneficiaryRelationship${contingentBeneficiaryCount}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-lang-zh="身份證/護照號碼" data-lang-en="ID/Passport Number">身份證/護照號碼</label>
                        <input type="text" name="contingentBeneficiaryIdNumber${contingentBeneficiaryCount}">
                    </div>
                    <div class="form-group">
                        <label data-lang-zh="分配比例 (%)" data-lang-en="Distribution Percentage (%)">分配比例 (%)</label>
                        <input type="number" name="contingentBeneficiaryPercentage${contingentBeneficiaryCount}" min="1" max="100">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label data-lang-zh="聯絡電話" data-lang-en="Contact Phone">聯絡電話</label>
                        <input type="tel" name="contingentBeneficiaryPhone${contingentBeneficiaryCount}">
                    </div>
                    <div class="form-group">
                        <label data-lang-zh="電子郵件" data-lang-en="Email">電子郵件</label>
                        <input type="email" name="contingentBeneficiaryEmail${contingentBeneficiaryCount}">
                    </div>
                </div>
                <div class="form-group">
                    <label data-lang-zh="地址" data-lang-en="Address">地址</label>
                    <textarea name="contingentBeneficiaryAddress${contingentBeneficiaryCount}" rows="3"></textarea>
                </div>
            `;
            
            contingentBeneficiariesContainer.appendChild(newContingentBeneficiary);
            
            // 更新語言
            switchLanguage(currentLang);
        }

        // 移除次位受益人
        function removeContingentBeneficiary(button) {
            const contingentBeneficiary = button.closest('.contingent-beneficiary');
            contingentBeneficiary.remove();
        }

        // 切換雇主欄位顯示
        function toggleEmployerFields() {
            const employmentFields = document.getElementById('employmentFields');
            const selectedSource = document.querySelector('input[name="incomeSource"]:checked');
            
            if (selectedSource && (selectedSource.value === 'employed' || selectedSource.value === 'selfEmployed')) {
                employmentFields.style.display = 'block';
                
                // 設置必填
                employmentFields.querySelectorAll('input').forEach(input => {
                    input.setAttribute('required', '');
                });
            } else {
                employmentFields.style.display = 'none';
                
                // 移除必填
                employmentFields.querySelectorAll('input').forEach(input => {
                    input.removeAttribute('required');
                });
            }
        }

        // 設置文件上傳
        function setupFileUploads() {
            const fileInputs = document.querySelectorAll('input[type="file"]');
            
            fileInputs.forEach(input => {
                const fileNameDisplay = document.getElementById(`${input.id}Name`);
                
                input.addEventListener('change', function() {
                    if (this.files.length > 0) {
                        fileNameDisplay.textContent = this.files[0].name;
                    } else {
                        fileNameDisplay.textContent = '';
                    }
                });
            });
        }

        // 生成表單預覽
        function generatePreview() {
            const previewContainer = document.getElementById('formPreview');
            previewContainer.innerHTML = '';
            
            // 收集最新數據
            collectFormData();
            
            // 委託人資料
            const settlorSection = document.createElement('div');
            settlorSection.className = 'review-item';
            settlorSection.innerHTML = `
                <h5 data-lang-zh="委託人資料" data-lang-en="Settlor Information">委託人資料</h5>
                <div class="review-field">
                    <label data-lang-zh="姓名" data-lang-en="Name">姓名</label>
                    <span>${formData.settlorName || ''}</span>
                </div>
                <div class="review-field">
                    <label data-lang-zh="身份證/護照號碼" data-lang-en="ID/Passport Number">身份證/護照號碼</label>
                    <span>${formData.settlorIdNumber || ''}</span>
                </div>
                <div class="review-field">
                    <label data-lang-zh="國籍" data-lang-en="Nationality">國籍</label>
                    <span>${formData.nationality || ''}</span>
                </div>
                <div class="review-field">
                    <label data-lang-zh="出生日期" data-lang-en="Date of Birth">出生日期</label>
                    <span>${formData.dateOfBirth || ''}</span>
                </div>
                <div class="review-field">
                    <label data-lang-zh="聯絡電話" data-lang-en="Contact Phone">聯絡電話</label>
                    <span>${formData.phone || ''}</span>
                </div>
                <div class="review-field">
                    <label data-lang-zh="電子郵件" data-lang-en="Email">電子郵件</label>
                    <span>${formData.email || ''}</span>
                </div>
                <div class="review-field">
                    <label data-lang-zh="地址" data-lang-en="Address">地址</label>
                    <span>${formData.address || ''}</span>
                </div>
            `;
            previewContainer.appendChild(settlorSection);
            
            // 更新語言
            switchLanguage(currentLang);
        }

        // 生成PDF
        function generatePDF() {
            // 顯示加載中
            document.getElementById('loadingMessage').style.display = 'block';
            
            // 收集表單數據
            collectFormData();
            
            // 創建PDF內容
            const pdfContent = document.createElement('div');
            pdfContent.innerHTML = `
                <div style="font-family: Arial, sans-serif; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="color: #c9b16a; margin-bottom: 10px;">國際離岸信託申請表單</h1>
                        <h2 style="color: #333;">Application for International Off-shore Trust</h2>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #c9b16a; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;">委託人資料 / Settlor Information</h3>
                        <p><strong>姓名 / Name:</strong> ${formData.settlorName || ''}</p>
                        <p><strong>身份證/護照號碼 / ID/Passport Number:</strong> ${formData.settlorIdNumber || ''}</p>
                        <p><strong>國籍 / Nationality:</strong> ${formData.nationality || ''}</p>
                        <p><strong>出生日期 / Date of Birth:</strong> ${formData.dateOfBirth || ''}</p>
                        <p><strong>聯絡電話 / Contact Phone:</strong> ${formData.phone || ''}</p>
                        <p><strong>電子郵件 / Email:</strong> ${formData.email || ''}</p>
                        <p><strong>地址 / Address:</strong> ${formData.address || ''}</p>
                    </div>
                </div>
            `;
            
            // 使用html2pdf庫生成PDF
            const element = pdfContent;
            const opt = {
                margin: 10,
                filename: '國際離岸信託申請表單.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            // 使用Promise鏈處理PDF生成
            html2pdf().set(opt).from(element).save().then(() => {
                // 隱藏加載中
                document.getElementById('loadingMessage').style.display = 'none';
                
                // 顯示成功訊息
                document.getElementById('successMessage').style.display = 'block';
                document.querySelector('.trust-form').style.display = 'none';
            });
        }

        // 重置表單
        function resetForm() {
            localStorage.removeItem('trustFormData');
            location.reload();
        }
    </script>
</body>
</html>
